apiVersion: v1
kind: Service
metadata:
  name: django-service
  namespace: messaging-app
  labels:
    app: django-messaging-app
  annotations:
    description: "Service to route traffic to Django app (blue-green deployments)"
spec:
  type: ClusterIP
  selector:
    app: django-messaging-app
  ports:
  - port: 8000
    targetPort: 8000
    protocol: TCP
    name: http
  sessionAffinity: None

---
apiVersion: v1
kind: Service
metadata:
  name: django-service-blue
  namespace: messaging-app
  labels:
    app: django-messaging-app
    version: blue
  annotations:
    description: "Service to route traffic specifically to blue deployment"
spec:
  type: ClusterIP
  selector:
    app: django-messaging-app
    deployment-type: blue
  ports:
  - port: 8000
    targetPort: 8000
    protocol: TCP
    name: http
  sessionAffinity: None

---
apiVersion: v1
kind: Service
metadata:
  name: django-service-green
  namespace: messaging-app
  labels:
    app: django-messaging-app
    version: green
  annotations:
    description: "Service to route traffic specifically to green deployment"
spec:
  type: ClusterIP
  selector:
    app: django-messaging-app
    deployment-type: green
  ports:
  - port: 8000
    targetPort: 8000
    protocol: TCP
    name: http
  sessionAffinity: None

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: django-pdb
  namespace: messaging-app
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: django-messaging-app
